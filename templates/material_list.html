{% extends "layout.html" %}

{% block title %}
	{{ job.name }}
{% endblock %}


{% block styles %}

	<link href="{{ url_for('static', filename='css/job.css') }}" rel="stylesheet">

{% endblock %}


{% block nav_links %}
	<li>
		<a href="{{ url_for('home') }}">Dashboard</a>
	</li>
	<li>
		<a href="#">Estimating</a>
	</li>
	<li class="active">
		<a href="{{ url_for('all_jobs') }}">Jobs</a>
	</li>
	<li>
		<a href="#">Settings</a>
	</li>
	<li>
		<a href="#">Help</a>
	</li>
{% endblock %}


{% block body %}

	<div class="col-sm-3 col-md-2 sidebar">
		<ul class="nav nav-sidebar">
			<li>
				<a href="{{ url_for('job_overview', job_num=job.number) }}">
					<span class="glyphicon glyphicon-eye-open"></span>&nbsp;
					Overview
				</a>
			</li>
			<li>
				<a href="{{ url_for('job_analytics', job_num=job.number) }}">
					<span class="glyphicon glyphicon-stats"></span>&nbsp;
					Analytics
				</a>
			</li>
			<li class="active">
				<a href="{{ url_for('job_materials', job_num=job.number) }}">
					<span class="glyphicon glyphicon-wrench"></span>&nbsp;
					Materials
				</a>
			</li>
			<li>
				<a href="{{ url_for('job_deliveries', job_num=job.number) }}">
					<span class="glyphicon glyphicon-plane"></span>&nbsp;
					Deliveries
				</a>
			</li>
			<li>
				<a href="{{ url_for('job_pos', job_num=job.number) }}">
					<span class="glyphicon glyphicon-piggy-bank"></span>&nbsp;
					Purchase Orders
				</a>
			</li>
			<li>
				<a href="{{ url_for('job_rentals', job_num=job.number) }}">
					Rental Logs
				</a>
			</li>
		</ul>
	</div><!-- /.sidebar -->
	<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
		<h1 class="page-header">
			{{ job.name }}&nbsp;
			<!-- TODO:implement link to unlock and edit job -->
			<a href="" class="btn btn-default btn-sm">
				Unlock for Editing
			</a>
		</h1>
		<ul class="nav nav-tabs" id="matListNav">
			<li role="presentation">
				<a href="{{ url_for('job_materials', job_num=job.number) }}">
					Material Lists
				</a>
			</li>
			<li role="presentation" class="active">
				<a href="#" class="disabled">
					{{ mlist }}
				</a>
			</li>
		</ul>

		<div class="row">

			<!-- TODO:save file under job folder directory structure -->
			<div class="col-xs-3 widgetWell">
				{{ objects.upload_modal(job=job, obj=mlist, meth='quote') }}
				{% if mlist.items %}
					{{ objects.list_modal(job=job, obj=mlist) }}
				{% elif mlist.doc %}
					<a href="{{ url_for('job_material_doc', job_num=job.number, doc_hash=mlist.hash) }}" target="_blank" class="btn btn-info">
	          View Material Document
					</a>
				{% endif %}
			</div>

			<div class="well col-xs-4 widgetWell pull-right">
				<!-- TODO:convert form/checkbox to http link -->
				<form class="form-inline" action="{{ url_for('update_material_list', m_hash=mlist.hash) }}" method="post">
					<div class="checkbox">
						<label>
							<input type="checkbox" name="sentOut" value="True" {% if mlist.sent_out %}checked{% endif %}>
							Sent to appropriate vendors
						</label>
					</div>
					<button type="submit" class="btn btn-default">Update</button>
				</form>
			</div>
			<div class="clearfix visible-lg-block"></div>

			<h3 id="listStatus">
				{%- if not mlist.sent_out %}
					<span class="label label-danger">List not sent for pricing</span>&nbsp;
				{% elif not mlist.quotes|length %}
					<span class="label label-warning">Expecting Quotes</span>&nbsp;
				{% endif -%}
				{%- if not mlist.po %}
					<span class="label label-danger">PO Not Issued</span>
				{% else %}
					{%- if mlist.fulfilled %}
						{% if not mlist.delivered %}
							<span class="label label-warning label-lg">PO Issued. Not Delivered</span>
						{% else %}
							<span class="label label-success label-lg">PO Issued. Delivered.</span>
						{% endif %}&nbsp;
						<span class="label label-info label-lg">{{ mlist.po }}</span>
					{% endif -%}
				{% endif -%}
			</h3>

			<label for="quoteTable">Associated Quotes:</label>
			<table class="table table-striped" id="quoteTable">
				<tr>
					<th><span class="glyphicon glyphicon-credit-card"></span></th>
					<th>Quote ID</th>
					<th>Vendor</th>
					<th>Date Sent:</th>
					<th>Price</th>
					<th>Del:</th>
				</tr>
				{% for i in mlist.quotes.itervalues() %}
				<!-- TODO:style rows based on age -->
					<tr class="{% if i.awarded %}success{% endif %}">
						<td id="{{ i.hash }}">
							{% if not i.awarded %}
								{% if not mlist.fulfilled %}
									<a href="{{ url_for('job_quote_award_po', doc_hash=i.hash, job_num=job.number) }}">
										<span class="glyphicon glyphicon-unchecked"></span>
									</a>
								{% else %}
									<a href="" class="disabled">
										<span class="glyphicon glyphicon-unchecked"></span>
									</a>
								{% endif %}
							{% else %}
							<!-- TODO:redirect to schedule delivery -->
								<a href="#" id="awardedPO">
										<span class="glyphicon glyphicon-star"></span>
								</a>
							{% endif %}
						</td>
						<td>
							{{ i.hash }}
							{% if i.doc %}
								<a target="_blank" href="{{ url_for('job_quote_doc', job_num=job.number, doc_hash=i.hash) }}">
									<span class="glyphicon glyphicon-paperclip"></span>
								</a>
							{% endif %}
						</td>
						<td>{{ i.vend }}</td>
						<td>{{ i.date_recvd.date() }}</td>
						<td>{{ i.price }}</td>
						<!-- TODO:show appropriate styling for completed lists -->
						<!-- TODO:add button for deleting material list -->
						<td>
							<a href="{{ url_for('delete_job_quote', doc_hash=i.hash, job_num=i.mat_list.job.number) }}">
								<span class="glyphicon glyphicon-trash"></span>
							</a>
						</td>
					</tr>
				{% endfor %}
			</table>

		</div>
	</div><!-- /.main -->

{% endblock %}