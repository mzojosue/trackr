{# templates/objects.html #}


{% macro todo(todo_obj, job=None) %}
{# TODO:implement delete link in panel-heading of todo_obj #}

	<div class="panel panel-warning">
		<div class="panel-heading" role="tab" id="{{ todo_obj.hash }}-heading">

			<h4 class="panel-title">
				<a data-toggle="collapse" data-parent="#{{ todo_obj.hash }}" href="#{{ todo_obj.hash }}-collapse"
					 aria-expanded="false" aria-controls="{{ todo_obj.hash }}-collapse">
					{{ todo_obj.name }}
					<a href="{{ url_for('todo_complete', t_hash=todo_obj.hash) }}">
						<span class="glyphicon glyphicon-unchecked pull-right"></span>
					</a>
				</a>
			</h4>

		</div>
		<div id="{{ todo_obj.hash }}-collapse" class="panel-collapse collapse" role="tabpanel"
				 aria-labelledby="{{ todo_obj.hash }}-heading">
			<div class="panel-body">
				{{ todo_obj.task }}
				<a href="{{ url_for('del_todo', t_hash=todo_obj.hash) }}">
						<span class="glyphicon glyphicon-trash pull-right"></span>
				</a>
			</div>

		</div>
	</div>

{% endmacro %}


{% macro new_job_todo(j_hash=None) %}
	{# TODO:templates.objects.new_job_todo should be identical to templates.objects.new_todo, except should give the option to be associated with the job in context #}

	<div class="panel panel-info">
		<div class="panel-heading" role="tab" id="newJobTodo">
			<h4 class="panel-title">
				<a data-toggle="collapse" data-parent="" href="#newJobTodo-collapse" aria-expanded="false"
					 aria-controls="newJobTodo-collapse">
					Add new task for job
				</a>
			</h4>
		</div>
		<div id="newJobTodo-collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="newJobTodo">
			<div class="panel-body">
				<form class="form-horizontal" method="post" action="{{ url_for('new_todo') }}">
					<div class="input-group">

						{# TODO:implement hidden input for storing job hash #}

						<input name="title" type="text" class="form-control" placeholder="New Task Title for job">
			<span class="input-group-btn">
		      <button class="btn btn-primary" type="submit">
						<span class="glyphicon glyphicon-plus"></span>
					</button>
			</span>
					</div>
					<input name="task" type="text" class="form-control" placeholder="Task Description">
				</form>
			</div>
		</div>
	</div>

{% endmacro %}


{% macro new_todo(job=False) %}

	<div class="panel panel-info">
		<div class="panel-heading" role="tab" id="newTodo">
			<h4 class="panel-title">
				<a data-toggle="collapse" data-parent="" href="#newTodo-collapse" aria-expanded="false"
					 aria-controls="newTodo-collapse">
					{% if job %}
						Add new task for {{ job.name }}
					{% else %}
						Add new task
					{% endif %}
				</a>
			</h4>
		</div>
		<div id="newTodo-collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="newTodo">
			<div class="panel-body">
				<form class="form-horizontal" method="post" action="{{ url_for('new_todo') }}">
					{% if job %}
						<input name="job" type="hidden" value="{{ job.number }}">
					{% endif %}
					<div class="input-group">
						<input name="title" type="text" class="form-control" placeholder="New Task Title">
						<span class="input-group-btn">
							<button class="btn btn-primary" type="submit">
								<span class="glyphicon glyphicon-plus"></span>
							</button>
						</span>
					</div>
					<input name="task" type="text" class="form-control" placeholder="Task Description">
				</form>
			</div>
		</div>
	</div>

{% endmacro %}


{% macro task_widget(todos=None, completed=None, job=False) %}

	<div class="col-sm-4 well well-lg todo-well pull-right">
		<div class="panel-group" id="accordian" role="tablist" aria-multiselectable="true">
			{% if job %}
				{{ new_todo(job=job) }}
				{% for i in job.tasks.itervalues() %}
					{{ todo(i) }}
				{% endfor %}
			{% else %}
				{{ new_todo() }}
				{% for i in todos %}
					{{ todo(i) }}
				{% endfor %}
			{% endif %}
		</div>
		{% if not job %}
			<div class="panel panel-success">
				<div class="panel-heading">
					Completed Tasks
				</div>
				<ul class="list-group">
					{% if not job %}
						{% for i in completed %}
							<li class="list-group-item">
								{{ i.name }}
							</li>
						{% endfor %}
					{% endif %}
				</ul>
			</div>
		{% endif %}
	</div><!-- /.col -->

{% endmacro %}


{% macro delivery_widget(job=False, obj=False) %}
	{# Responsible for tracking and updating delivery of materials to and from the jobsite #}

	{# TODO:set delivery iterable #}
	<div class="col-sm-4">
    {% if not obj %}  {# widget is being displayed on material list page #}
      <div class="panel panel-info">
        <div class="panel-heading">
          {% if job %}
            Deliveries scheduled for {{ job.name }}
          {% else %}
            Scheduled Deliveries
          {% endif %}
          <a href="#">
            <span class="glyphicon glyphicon-link"></span>
          </a>
        </div>
        <!-- /.panel-heading -->
        <ul class="list-group">
          {% if job %}
            {% for i in job.deliveries.itervalues() %}
              {% if i.countdown < 2 %}
                <li class="list-group-item list-group-item-danger">
              {% elif i.countdown < 5 %}
                <li class="list-group-item list-group-item-warning">
              {% else %}
                <li class="list-group-item">
              {% endif %}
                <!-- TODO:set link to deliveries page -->
                <a href="{{ url_for('material_list', m_hash=i.mat_list.hash) }}">
                  From {{ i.vend }} expected <span class="label label-info">{{ i.expected.date() }}</span>
                </a>
              </li>
            {% endfor %}
          {% else %}
            {% for i in Delivery.db.itervalues() %}
              {% if i.countdown < 2 %}
                <li class="list-group-item list-group-item-danger">
              {% elif i.countdown < 5 %}
                <li class="list-group-item list-group-item-warning">
              {% else %}
                <li class="list-group-item">
              {% endif %}
                <!-- TODO:set link to deliveries page -->
                <a href="#">Delivery from {{ i.vend }}, expected <span class="label label-info">{{ i.expected.date() }}</span> for {{ i.job }}</a>
              </li>
            {% endfor %}
          {% endif %}<!-- /.list-group-item -->
        </ul><!-- /.list-group -->
      </div><!-- /.panel -->
    {% endif %}
		<div class="panel panel-primary">
			<div class="panel-heading">
				Schedule Delivery/Backorder
			</div>
			<!-- /.panel-heading -->
			<div class="panel-body">
				<!-- TODO:change input elements and form action if `job` exists -->
				{% if job %}
					<form class="form-horizontal" action="{{ url_for('schedule_delivery', job_num=job.number) }}" method="post">

				{% else %}
					<form class="form-horizontal" action="{{ url_for('schedule_delivery') }}" method="post">
						<div class="form-group col-sm-12">
							<label for="jobSelect">Select a Job:</label>
							<select name="job-number" id="jobSelect" class="form-control" onchange="update_mat_list()">
								<option selected>Please select a job</option>
								{% for i in Job.db.itervalues() %}
									<option value="{{ i.number }}">{{ i.name }}</option>
								{% endfor %}
							</select>
						</div>

				{% endif %}<!-- /.form-group -->
          {% if not obj %}
            <div class="form-group col-sm-12">
              <label for="materialList">
                Material List to Deliver:
              </label>
              <select name="materialListHash" id="materialList" class="form-control">
                <option selected>Please select a job first</option>
                {% if job %}
                  {% for i in job.materials.itervalues() if (i.fulfilled and not i.delivered) %}
                    <option value="{{ i.hash }}">{{ i }}</option>
                  {% endfor %}
                {% else %}
                  <!--{% for i in MaterialList.db.itervalues() if (i.fulfilled and not i.delivered) %}
                    <option value="{{ i.hash }}">{{ i }}</option>
                  {% endfor %}-->

                {% endif %}
              </select>
            </div><!-- /.form-group -->
          {% else %}
            <input type="hidden" name="materialListHash" value={{ obj.hash }}>
          {% endif %}

					<div class="form-group col-sm-12">
						<label for="destination">
							Delivery Destination:
						</label>
						<select name="destination" id="destination" class="form-control">
							<option value="jobsite">Ship to Jobsite</option>
							<option value="shop">Ship to Shop</option>
							{# TODO:implement a third option to enable an arbitrary destination value #}
						</select>
					</div>

					<label for="deliveryDate">
						Delivery Date:
					</label>
					<div class="form-inline">
						<input type="date" name="deliveryDate" id="deliveryDate" class="form-control">
						<input class="btn btn-sm btn-primary" type="submit">
					</div><!-- /.form-inline -->
				{% if job %}
					</form>
				{% else %}
					</form>
				{% endif %}

			</div>
		</div><!-- /.panel -->
	</div><!-- /.col -->

{% endmacro %}


{% macro materials_widget(job=None) %}
	{# Widget for managing the tracking and purchasing of materials ordered from the jobsite #}

	<div class="col-sm-4">
		<div class="panel panel-info">
			<div class="panel-heading">
				Open Material Lists
				{% if job %}
					<a href="{{ url_for('job_materials', job_num=job.number) }}">
						<span class="glyphicon glyphicon-link"></span>
					</a>
				{% else %}
					<a href="{{ url_for('material') }}">
						<span class="glyphicon glyphicon-link"></span>
					</a>
				{% endif %}
			</div><!-- /.panel-heading -->
			<ul class="list-group">
				{% if job %}
					{% for mlist in job.materials.itervalues() if not mlist.fulfilled %}
						<li class="list-group-item">
							<a href="{{ url_for('material_list', m_hash=mlist.hash) }}">
								{{ mlist }}
							</a>
							{% if mlist.quotes|length %}
								<span class="glyphicon glyphicon-paperclip"></span>
							{% endif %}
							{% if mlist.doc %}
								<a target="_blank" href="{{ url_for('job_material_doc', doc_hash=mlist.hash) }}">
									<span class="glyphicon glyphicon-open-file"></span>
								</a>
							{% elif mlist.items %}
								<span class="glyphicon glyphicon-th-list"></span>
							{% endif %}
						</li>
					{% else %}
						<li class="list-group-item">
							No open material lists.
						</li>
					{% endfor %}
				{% else %}
					{% for mlist in MaterialList.db.itervalues() if not mlist.fulfilled %}
						<li class="list-group-item">
							<a href="{{ url_for('material_list', m_hash=mlist.hash) }}">
								{{ mlist }}
							</a>
							{% if mlist.quotes|length %}
								<span class="glyphicon glyphicon-paperclip"></span>
							{% endif %}
							{% if mlist.doc %}
								<a target="_blank" href="{{ url_for('job_material_doc', doc_hash=mlist.hash) }}">
									<span class="glyphicon glyphicon-open-file"></span>
								</a>
							{% endif %}
						</li>
					{% else %}
						<li class="list-group-item">
							No open material lists.
						</li>
					{% endfor %}
				{% endif %}
				<!-- /.list-group-item -->
			</ul><!-- /.list-group -->
			{# TODO:check if material list iterable is >0 #}
			<div class="panel-body" id="quoteUpload">
				<h5>Add quote:</h5>
				<form class="form-horizontal" action="{{ url_for('quote') }}" enctype="multipart/form-data" method="post">
					<div class="form-group col-xs-12">
						<select class="form-control" name="materialList">
							<option selected>Select Material List</option>
							{% if job %}
								{% for i in job.materials.itervalues() if not i.fulfilled %}
									<option value="{{ i.hash }}">{{ i }}</option>
								{% else %}
									<option>No open material lists</option>
								{% endfor %}
							{% else %}
								{% for i in MaterialList.db.itervalues() if not i.fulfilled %}
									<option value="{{ i.hash }}">{{ i }}</option>
							  {% else %}
									<option>No open material lists</option>
								{% endfor %}
							{% endif %}
						</select>
					</div>
          <!-- /.form-group -->
					<div class="form-group form-inline col-xs-12">
						<input type="file" name="quote">
					</div>
          <button class="btn btn-primary btn-sm pull-right" type="submit">Upload</button>
        </form>
			</div><!-- /.panel-body -->
		</div><!-- /.panel -->
	</div><!-- /.col -->

{% endmacro %}


{% macro dir_upload() %}

<!-- TODO:implement directory upload -->

	<form action="{{ url_for('upload_directory') }}" enctype="multipart/form-data" method="post">
		<input type="file" name="file"  webkitdirectory="" directory="">
		<input type="submit">
	</form>

{% endmacro %}


{% macro upload_modal(job=False, obj=None, meth='material') %}

	<!-- Button trigger modal -->
	<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#uploadModal">
		{% if meth == 'material' %}
	    Upload Doc
		{% else %}
			Upload Quote
		{% endif %}
	</button>

	<!-- Modal -->
	<div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">

	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="uploadModalLabel">
		        {% if meth == 'material' %}
		          Upload Material List
		        {% elif meth == 'quote' %}
		          Upload Material Quote
		        {% endif %}
	        </h4>
	      </div>

	      <div class="modal-body">

	        {% if meth == 'material' %}

		        <form id="uploadForm" action="{{ url_for('job_materials', job_num=job.number) }}" enctype="multipart/form-data" method="post">
			        <div class="form-group itemLineDiv">
				        <label for="listLabel">
					        Label for Material List:
				        </label>
				        <input type="text" id="listLabel" class="form-control" name="listLabel" placeholder="Descriptive Label">
				      </div>
							<input type="file" name="file" id="fileUpload">
			        <div class="form-group">
				        <label for="dateSubmitted">
					        Date Submitted:
				        </label>
				        <input type="date" name="dateSubmitted" id="dateSubmitted" class="form-control" value="{{ today().date() }}">
			        </div>
			        <div class="form-group">
				        <label for="dateRequired">
					        Date Required:
				        </label>
				        <input type="date" name="dateRequired" id="dateRequired" class="form-control">
			        </div>
						</form>

		      {% elif meth == 'quote' %}

						<form id="uploadForm" action="{{ url_for('quote') }}" enctype="multipart/form-data" method="post">
							<input type="hidden" name="materialList" value="{{ obj.hash }}">
							<input type="file" name="quote" id="fileUpload">
							<div class="form-group">
								<label for="vendName">Vendor:</label>
								<input type="text" name="vendor" id="vendName" class="form-control" placeholder="Vendor Name">
							</div>
							<div class="form-group">
								<label class="control-label" for="quotePrice">Quoted Price:</label>
								<div class="input-group" id="quotePrice">
									<span class="input-group-addon">
										<span class="glyphicon glyphicon-usd"></span>
									</span>
									<input type="text" name="quotePrice" class="form-control" value="0.0">
								</div>
							</div>
						</form>

		      {% endif %}
	      </div>

	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
	        <button type="submit" class="btn btn-primary" form="uploadForm">Finalize Upload</button>
	      </div>

	    </div>
	  </div>
	</div>

{% endmacro %}


{% macro item_modal(job=False, obj=None, meth='material') %}

	<!-- Button trigger modal -->
	<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#itemModal">
	  Input Items
	</button>

	<!-- Modal -->
	<div class="modal fade" id="itemModal" tabindex="-1" role="dialog" aria-labelledby="itemModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">

	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="itemModalLabel">
		        {% if meth == 'material' %}
		          Entering Items
		        {% elif meth == 'quote' %}
		          Upload Material Quote
		        {% endif %}
	        </h4>
	      </div>

	      <div class="modal-body">

	        {% if meth == 'material' %}
						<!-- TODO:create input for naming material list -->
		        <form id="itemizedMaterialForm" action="{{ url_for('job_materials', job_num=job.number) }}" enctype="multipart/form-data" method="post">
							<input type="hidden" value="0" id="itemCounter" name="itemCounter">
			        <div class="form-group itemLineDiv">
				        <label for="listLabel">
					        Label for Material List:
				        </label>
				        <a class="pull-right" href="javascript:;" onclick="addMaterialItem();">
					        <span class="glyphicon glyphicon-plus"></span>
				        </a>
				        <input type="text" id="listLabel" class="form-control" name="listLabel" placeholder="Descriptive Label">
				      </div>
			        <label for="itemizedMaterialArea">
				        Items:
			        </label>
			        <div id="itemizedMaterialArea" class="row">
				        {# Item line elements will be populated here #}
			        </div>
			        <div class="form-group">
				        <label for="dateRequired">
					        Date Required:
				        </label>
				        <input type="date" name="dateRequired" id="dateRequired" class="form-control">
			        </div>
						</form>

		      {% endif %}
	      </div>

	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
	        <button type="submit" class="btn btn-primary" form="itemizedMaterialForm">Upload</button>
	      </div>

	    </div>
	  </div>
	</div>

{% endmacro %}


{% macro list_modal(job=False, obj=None) %}

	<!-- Button trigger modal -->
	<button type="button" class="btn btn-info" data-toggle="modal" data-target="#listModal">
	  View Item List
	</button>

	<!-- Modal -->
	<div class="modal fade" id="listModal" tabindex="-1" role="dialog" aria-labelledby="listModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">

	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="listModalLabel">
		        {{ obj }}
	        </h4>
	      </div>

	      <div class="modal-body">
		      {% if obj.items is not string %}
            <ul class="list-group">
				      {% for item in obj.items %}
				        <li class="list-group-item">{{ item }}</li>
				      {% endfor %}
            </ul>
          {% else %}
            {# usually executes if material list was imported from PO log #}
            <span>{{ obj.items }}</span>
          {% endif %}
	      </div>

	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
	        <button type="submit" class="btn btn-primary">Edit</button>
	      </div>

	    </div>
	  </div>
	</div>

{% endmacro %}


{% macro inventory_item_modal() %}

	<!-- Button trigger modal -->
	<button type="button" class="btn btn-warning" data-toggle="modal" data-target="#invModal">
	  New Item List
	</button>

	<!-- Modal -->
	<div class="modal fade" id="invModal" tabindex="-1" role="dialog" aria-labelledby="invModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">

	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="invModalLabel">
		        New Inventory Item
	        </h4>
	      </div>

	      <div class="modal-body">
          <form action="{{ url_for('new_inventory_item') }}" name="itemIDForm" id="itemIDForm" method="post" enctype="multipart/form-data">
            <div class="form-group">
              <label for="itemID">
                Item ID:
              </label>
              <input id="itemID" name="itemID" type="text" class="form-control">
            </div>
            <div class="form-group">
              <label for="itemLabel">
                Item Label:
              </label>
              <input id="itemLabel" name="itemLabel" type="text" class="form-control">
            </div>
          </form>
	      </div>

	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
	        <button type="submit" class="btn btn-primary" form="itemIDForm">Submit</button>
	      </div>

	    </div>
	  </div>
	</div>

{% endmacro %}


{% macro inventory_order_modal() %}

	<!-- Button trigger modal -->
	<button type="button" class="btn btn-warning" data-toggle="modal" data-target="#invOrderModal">
	  Input Order
	</button>

	<!-- Modal -->
	<div class="modal fade" id="invOrderModal" tabindex="-1" role="dialog" aria-labelledby="invOrderModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">

	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="invOrderModalLabel">
		        New Inventory Item
	        </h4>
	      </div>

	      <div class="modal-body">
          <form action="{{ url_for('inventory_item_order') }}" name="itemOrderForm" id="itemOrderForm" method="post" enctype="multipart/form-data">
            <div class="form-group">
              <label for="itemOrderID">
                Item ID:
              </label>
              <input id="itemOrderID" name="itemOrderID" type="text" class="form-control">
              <p class="help-block">Input item name or ID</p>
            </div>
            <div class="form-group">
              <label for="vendorName">
                Vendor:
              </label>
              <input id="vendorName" name="vendorName" type="text" class="form-control">
            </div>
            <div class="form-group">
              <label for="orderPrice">
                Order Price
              </label>
              <input id="orderPrice" name="orderPrice" type="text" class="form-control">
            </div>
            <div class="form-group">
              <label for="orderAmount">
                Order Amount
              </label>
              <!-- TODO:create javascript to listen on #itemOrderID to change input type based on the items unit of measure -->
              <input id="orderAmount" name="orderAmount" type="text" class="form-control">
            </div>
          </form>
	      </div>

	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
	        <button type="submit" class="btn btn-primary" form="itemOrderForm">Submit</button>
	      </div>

	    </div>
	  </div>
	</div>

{% endmacro %}